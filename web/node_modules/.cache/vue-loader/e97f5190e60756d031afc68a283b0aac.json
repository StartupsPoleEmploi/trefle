{"remainingRequest":"/home/lucas/Documents/PE/LBF/branches/trefle-deploy/web/srv/trefle-src/web/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/lucas/Documents/PE/LBF/branches/trefle-deploy/web/srv/trefle-src/web/src/components/Simulateur.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/lucas/Documents/PE/LBF/branches/trefle-deploy/web/srv/trefle-src/web/src/components/Simulateur.vue","mtime":1574433547000},{"path":"/home/lucas/Documents/PE/LBF/branches/trefle-deploy/web/srv/trefle-src/web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/lucas/Documents/PE/LBF/branches/trefle-deploy/web/srv/trefle-src/web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/lucas/Documents/PE/LBF/branches/trefle-deploy/web/srv/trefle-src/web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/lucas/Documents/PE/LBF/branches/trefle-deploy/web/srv/trefle-src/web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCi8qCmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAnU2ltdWxhdGV1cicsCiAgZGF0YTogKCkgPT4gewogICAgcmV0dXJuIHsKICAgICAgICBmaW5hbmNlbWVudHMgPSBbXSwKICAgICAgICBjb250ZXh0ID0ge30sCiAgICAgICAgZXJyb3JzID0ge30KICAgIH0KICB9LAogIGNyZWF0ZWQ6ICgpID0+IHsKICAgIGxvYWQoKTsKICB9LAogIG1ldGhvZHM6IHsKICAgIGxvYWQ6ICgpID0+IHsKICAgICAgaWYgKHRoaXMub3B0cy51cmwpIHRoaXMuc2ltdWxhdGVfdXJsKHRoaXMub3B0cy51cmwpCiAgICB9LAogICAgb25FcnJvcjogKCkgPT4gewogICAgICB0aGlzLmVycm9ycyA9IGRhdGEKICAgICAgdGhpcy51cGRhdGUoKQogICAgfSwKICAgIGRlY29kZUxCRlVSTDogKHVybCwgY2FsbGJhY2spID0+IHsKICAgICAgcmVxdWVzdChgLi4vZXhwbG9yZS9kZWNvZGUtbGJmLXVybD91cmw9JHtlbmNvZGVVUklDb21wb25lbnQodXJsKX1gKQogICAgICAudGhlbihjYWxsYmFjaywgdGhpcy5vbkVycm9yKQogICAgfSwKICAgIHNpbXVsYXRlOiAoZGF0YSwgdGFncyA9ICcnKSA9PiB7CiAgICAgIGlmICh0YWdzKSB0YWdzID0gJyZ0YWdzPScgKyB0YWdzLnRvU3RyaW5nKCk7CiAgICAgIHJlcXVlc3QoJy9maW5hbmNlbWVudD9jb250ZXh0PTEmc2NlbmFyaW89MSZleHBsYWluPTEnICsgdGFncywgewogICAgICAgIG1ldGhvZDogJ3Bvc3QnLAogICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KGRhdGEpCiAgICAgIH0pCiAgICAgIC50aGVuKChkYXRhKSA9PiB7CiAgICAgICAgdGhpcy5maW5hbmNlbWVudHMgPSBkYXRhLmZpbmFuY2VtZW50cwogICAgICAgIHRoaXMuY3VycmVudEZpbHRlciA9ICcnCiAgICAgICAgaWYgKCF0YWdzKSB7CiAgICAgICAgICAgIHZhciBfdGFncyA9IG5ldyBBcnJheSgpCiAgICAgICAgICAgIHZhciBfdGFnc0VsaWdpYmxlID0gbmV3IEFycmF5KCkKICAgICAgICB9CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmZpbmFuY2VtZW50cy5sZW5ndGg7IGkrKykgewogICAgICAgICAgLy8gUmlvdCBzdWNrcyBvbiBgdGFnc2DigKYKICAgICAgICAgIHRoaXMuZmluYW5jZW1lbnRzW2ldWydfdGFncyddID0gdGhpcy5maW5hbmNlbWVudHNbaV1bJ3RhZ3MnXQogICAgICAgICAgaWYoX3RhZ3MpIF90YWdzID0gX3RhZ3MuY29uY2F0KHRoaXMuZmluYW5jZW1lbnRzW2ldWyd0YWdzJ10pCiAgICAgICAgICBpZihfdGFnc0VsaWdpYmxlICYmIHRoaXMuZmluYW5jZW1lbnRzW2ldWydlbGlnaWJsZSddKSBfdGFnc0VsaWdpYmxlID0gX3RhZ3NFbGlnaWJsZS5jb25jYXQodGhpcy5maW5hbmNlbWVudHNbaV1bJ3RhZ3MnXSkKICAgICAgICB9CiAgICAgICAgaWYoX3RhZ3MpIHRoaXMuX3RhZ3MgPSBbLi4ubmV3IFNldChfdGFncyldLnNvcnQoKQogICAgICAgIGlmKF90YWdzRWxpZ2libGUpIHRoaXMuX3RhZ3NFbGlnaWJsZSA9IFsuLi5uZXcgU2V0KF90YWdzRWxpZ2libGUpXQogICAgICAgIGlmKHRhZ3MpIHRoaXMuY3VycmVudEZpbHRlciA9IHRhZ3MKICAgICAgICB0aGlzLmNvbnRleHQgPSBkYXRhLmNvbnRleHQKICAgICAgICB0aGlzLnNjZW5hcmlvID0gZGF0YS5zY2VuYXJpbwogICAgICAgIHRoaXMudXBkYXRlKCkKICAgICAgfSwgdGhpcy5vbkVycm9yKQogICAgfSwKICAgIHNpbXVsYXRlX3VybDogKHVybCkgPT4gewogICAgICB0aGlzLmRlY29kZUxCRlVSTCh1cmwsIHRoaXMuc2ltdWxhdGUpCiAgICB9LAogICAgdG9nZ2xlOiAoZSkgPT4gewogICAgICB2YXIgaXRlbSA9IGUuaXRlbQogICAgICBpdGVtLnZpc2libGUgPSAhaXRlbS52aXNpYmxlCiAgICB9LAogICAgdG9nZ2xlRmFpbGVkOiAoKSA9PiB7CiAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5mYWlsZWQnKS5mb3JFYWNoKChlKSA9PiB7IGUucGFyZW50Tm9kZS5jbGFzc0xpc3QudG9nZ2xlKCdoaWRlJykgfSkKICAgIH0sCiAgICBmaWx0ZXI6IChlKSA9PiB7CiAgICAgIHZhciBmaWx0ZXJUYWcgPSAnJwogICAgICBpZih0eXBlb2YgZS5pdGVtICE9PSAndW5kZWZpbmVkJyAmJiB0eXBlb2YgZS5pdGVtLnRhZyAgPT0gJ3N0cmluZycpCiAgICAgIHsKICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5maWx0ZXIgLmxhYmVsJykuZm9yRWFjaCgoZSkgPT4geyBlLmNsYXNzTGlzdC5yZW1vdmUoJ3NlbGVjdGVkJyk7IGUuY2xhc3NMaXN0LmFkZCgnbGlnaHRlbicpIH0pCiAgICAgICAgICBlLnRhcmdldC5jbGFzc0xpc3QuYWRkKCdzZWxlY3RlZCcpOwogICAgICAgICAgZS50YXJnZXQuY2xhc3NMaXN0LnJlbW92ZSgnbGlnaHRlbicpOwogICAgICAgICAgZmlsdGVyVGFnID0gZS5pdGVtLnRhZwogICAgICB9CiAgICAgIGVsc2UKICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5maWx0ZXIgLmxhYmVsJykuZm9yRWFjaCgoZSkgPT4geyBlLmNsYXNzTGlzdC5yZW1vdmUoJ3NlbGVjdGVkJyk7IGUuY2xhc3NMaXN0LnJlbW92ZSgnbGlnaHRlbicpIH0pCgogICAgICB0aGlzLnNpbXVsYXRlICggdGhpcy5jb250ZXh0LCBmaWx0ZXJUYWcgKQogICAgfSwKICAgIHNlbGVjdFNjZW5hcmlvOiAoZSkgPT4gewogICAgICBlLnRhcmdldC5zZWxlY3QoKQogICAgfQogIH0KfSovCg=="},{"version":3,"sources":["Simulateur.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Simulateur.vue","sourceRoot":"src/components","sourcesContent":["<template>\n    <div id=\"Simulateur\">\n\n  <section>\n      <h2 class=\"page-title\">Simuler depuis un résultat de financement LBF <a v-if=\"opts.url\" :href=\"opts.url\"><i class=icon>link</i></a></h2>\n  </section>\n  <section v-if=\"Object.keys(this.errors).length && !Object.keys(this.context).length\" class=results>\n    <ul>\n      <li v-for=\"error in this.errors\" :key=\"error.id\"><strong>{{ error.key }}</strong> {{ error.message }}</li>\n    </ul>\n  </section>\n  <section class=results v-if=\"Object.keys(this.context).length\">\n    <h2>Financements</h2>\n    <p class=\"filter\">\n        <span :click=\"this.filter()\" class=\"label {eligible: this._tagsEligible.includes(tag)}\" v-for=\"tag in this.tags\" :key=\"tag.id\">{{ tag }}</span>\n    </p>\n    <p v-if=\"this.currentFilter\">\n        <input type=\"checkbox\" :click=\"this.checked=this.filter()\" value=\"Tous les financements éligibles\"/>\n    </p>\n    <p v-else>\n        <input type=\"checkbox\" :click=\"this.checked=this.toggleFailed()\" value=\"Tous les financements\"/>\n    </p>\n      <ul>\n        <li v-for=\"financement in  this.financements\" :key=\"financement.id\" class=\"result:'result', visible: visible, hide: (!eligible && !this.currentFilter)\">\n          <h3 class=\"passed: eligible, failed: !eligible\" :click=\"parent.toggle\">{{ financement.intitule }}\n              <label :click=\"this.filter()\" class=\"label\" v-for=\"tag in tags\" :key=\"tag.id\">{{ tag }}</label>\n          </h3>\n          <p><strong>Description</strong> {{ financement.description }}</p>\n          <p><strong>Démarches</strong> {{ financement.demarches }}</p>\n          <virtual v-if=\"eligible\">\n            <p><strong>Prise en charge</strong> {{ financement.prise_en_charge }}</p>\n            <p v-if=\"prise_en_charge_texte\"><strong>Prise en charge</strong> {{ prise_en_charge_texte }}</p>\n            <p><strong>Plafond de prise en charge</strong> {{ plafond_prise_en_charge }}</p>\n            <p><strong>Plafond de prix horaire</strong> {{ plafond_prix_horaire }}</p>\n            <p><strong>Nombre d'heures prises en charge</strong> {{ heures }}</p>\n            <p><strong>Rémunération</strong> {{ remuneration }}</p>\n            <p v-if=\"remuneration_texte\"><strong>Rémunération</strong> {{ remuneration_texte  }}</p>\n            <p v-if=\"fin_remuneration\"><strong>Fin de la rémunération</strong> {{ renderValue('financement.fin_remuneration', fin_remuneration) }}</p>\n            <p v-if=\"rff\"><strong>RFF</strong> {{ rff }}</p>\n            <p v-if=\"debut_rff\"><strong>Début de la RFF</strong> {{ renderValue('financement.debut_rff', debut_rff) }}</p>\n            <p v-if=\"fin_rff\"><strong>Fin de la RFF</strong> {{ renderValue('financement.fin_rff', fin_rff) }}</p>\n            <p v-if=\"organisme\"><strong>Organisme</strong> {{ organisme.nom }}</p>\n          </virtual>\n          <p>\n            <strong>Règles de gestion</strong>\n            <eligibilite conditions= {{ explain }}></eligibilite>\n          </p>\n        </li>\n      </ul>\n      <p v-if=\"!this.financements.length\">Aucun financement trouvé.</p>\n      <h2>Contexte</h2>\n      <context :data=\"this.context\"></context>\n      <h2>Scénario de test</h2>\n      <textarea :focus=\"this.selectScenario\" v-model=\"this.scenario\"></textarea>\n    </section>\n    <section class=\"results\" v-else>\n        <p>Vous devez faire une simulation sur LBF et cliquer sur le bouton \"simuler sur trèfle\"</p>\n        <p> Pour voir le bouton sur le site de production glisser/déposer ce lien dans votre bookmark <a class=\"button\" href=\"\">LBF mode expert</a></p>\n    </section>\n    </div>\n</template>\n<script>\n/*\nexport default {\n  name: 'Simulateur',\n  data: () => {\n    return {\n        financements = [],\n        context = {},\n        errors = {}\n    }\n  },\n  created: () => {\n    load();\n  },\n  methods: {\n    load: () => {\n      if (this.opts.url) this.simulate_url(this.opts.url)\n    },\n    onError: () => {\n      this.errors = data\n      this.update()\n    },\n    decodeLBFURL: (url, callback) => {\n      request(`../explore/decode-lbf-url?url=${encodeURIComponent(url)}`)\n      .then(callback, this.onError)\n    },\n    simulate: (data, tags = '') => {\n      if (tags) tags = '&tags=' + tags.toString();\n      request('/financement?context=1&scenario=1&explain=1' + tags, {\n        method: 'post',\n        body: JSON.stringify(data)\n      })\n      .then((data) => {\n        this.financements = data.financements\n        this.currentFilter = ''\n        if (!tags) {\n            var _tags = new Array()\n            var _tagsEligible = new Array()\n        }\n        for (var i = 0; i < this.financements.length; i++) {\n          // Riot sucks on `tags`…\n          this.financements[i]['_tags'] = this.financements[i]['tags']\n          if(_tags) _tags = _tags.concat(this.financements[i]['tags'])\n          if(_tagsEligible && this.financements[i]['eligible']) _tagsEligible = _tagsEligible.concat(this.financements[i]['tags'])\n        }\n        if(_tags) this._tags = [...new Set(_tags)].sort()\n        if(_tagsEligible) this._tagsEligible = [...new Set(_tagsEligible)]\n        if(tags) this.currentFilter = tags\n        this.context = data.context\n        this.scenario = data.scenario\n        this.update()\n      }, this.onError)\n    },\n    simulate_url: (url) => {\n      this.decodeLBFURL(url, this.simulate)\n    },\n    toggle: (e) => {\n      var item = e.item\n      item.visible = !item.visible\n    },\n    toggleFailed: () => {\n      document.querySelectorAll('.failed').forEach((e) => { e.parentNode.classList.toggle('hide') })\n    },\n    filter: (e) => {\n      var filterTag = ''\n      if(typeof e.item !== 'undefined' && typeof e.item.tag  == 'string')\n      {\n          document.querySelectorAll('.filter .label').forEach((e) => { e.classList.remove('selected'); e.classList.add('lighten') })\n          e.target.classList.add('selected');\n          e.target.classList.remove('lighten');\n          filterTag = e.item.tag\n      }\n      else\n          document.querySelectorAll('.filter .label').forEach((e) => { e.classList.remove('selected'); e.classList.remove('lighten') })\n\n      this.simulate ( this.context, filterTag )\n    },\n    selectScenario: (e) => {\n      e.target.select()\n    }\n  }\n}*/\n</script>"]}]}